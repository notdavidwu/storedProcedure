{% load static%}

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/highlight-within-textarea@2.0.5/jquery.highlight-within-textarea.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/highlight-within-textarea@2.0.5/jquery.highlight-within-textarea.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.21.3/dist/bootstrap-table.min.css">
<script src="https://unpkg.com/bootstrap-table@1.21.3/dist/bootstrap-table.min.js"></script>
<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css">
<link href="https://unpkg.com/bootstrap-table@1.21.3/dist/bootstrap-table.min.css" rel="stylesheet">
<link href="https://unpkg.com/bootstrap-table@1.21.3/dist/extensions/sticky-header/bootstrap-table-sticky-header.css" rel="stylesheet">

<script src="https://unpkg.com/bootstrap-table@1.21.3/dist/bootstrap-table.min.js"></script>
<script src="https://unpkg.com/bootstrap-table@1.21.3/dist/extensions/sticky-header/bootstrap-table-sticky-header.min.js"></script>

<link href="https://unpkg.com/perfect-scrollbar@1.4.0/css/perfect-scrollbar.css" rel="stylesheet">
<link href="https://unpkg.com/bootstrap-table@1.21.3/dist/bootstrap-table.min.css" rel="stylesheet">

<script src="https://unpkg.com/perfect-scrollbar@1.4.0/dist/perfect-scrollbar.min.js"></script>
<script src="https://unpkg.com/bootstrap-table@1.21.3/dist/bootstrap-table.min.js"></script>



<script>    
    $(document).ready(function () {        
        //建立挑選器
        newDualListBox();
        //取得表格資料
        printAllData();
        printAllData_3();
        printAllPData();

    });

    //顯示資料
    function printAllData(){
        response = getTextTokenData();
        ////console.log("response.data : ", response.data);
        $('#statistics').empty();
        $('#statistics').append(`<table id='sortTable' class="table table-striped" data-toggle="table"  data-search="true" data-custom-search="customSearch" data-reset-search="resetSearch" 
        data-pagination="true"
        data-pagination-h-align="left"
        data-pagination-detail-h-align="right"
        data-page-size="300"
        data-height="700"        
        data-loading-template="loadingTemplate"        
        data-page-list="[10, 25, 50, 100, 200, All]"
        >
        </table>`);
        $('#sortTable').bootstrapTable({
            columns: [{
                field: 'No',
                title: 'No',
                align: 'center',
                valign: 'middle',
                sortable:true,
            },{
                field: 'First',
                title: 'First',
                sortable:true,

            }, {
                field: 'Second',
                title: 'Second',
                sortable:true,
            }, {
                field: 'Times',
                title: 'Times',
                sortable:true,
            }, {
                field: 'Mergecheck',
                title: 'Mergecheck',
                sortable:true,
            }],
            data:response.data,
            paginationParts: ["pageSize", "pageList"],
            stickyHeader: true,
        })
        $('#statistics .fixed-table-toolbar').attr('id', 'table_2word');
        $('#table_2word').append(`<select class="form-select form-select-sm" aria-label=".form-select-sm example" id="tableSelect1">
            <option selected value="1">Search First</option>
            <option value="2">Search Second</option>
            <option value="3">Search Times</option>
          </select>`);
        //$('#table_2word').append(`<button onclick="resetSearch()" class="btn btn-secondary bg-secondary" id="resetSearch">reset</button>`);
    }

    //顯示資料
    function printAllData_3(){        
        response = getTextTokenData_3();
        ////console.log("response.data : ", response.data);
        
        $('#statistics').empty();
        $('#statistics').append(`<table id='sortTable' class="table table-striped" data-toggle="table"  data-search="true" data-custom-search="customSearch"
        data-pagination="true"
        data-pagination-h-align="left"
        data-pagination-detail-h-align="right"
        data-page-size="300"        
        data-height="700">
        </table>`);
        $('#sortTable').bootstrapTable({
            columns: [{
                field: 'No',
                title: 'No',
                align: 'center',
                valign: 'middle',
                sortable:true,
            },
            {
                field: 'First',
                title: 'First',
                sortable:true,

            }, 
            {
                field: 'Second',
                title: 'Second',
                sortable:true,
            }, 
            {
                field: 'Third',
                title: 'Third',
                sortable:true,
            }, 
            {
                field: 'Times',
                title: 'Times',
                sortable:true,
            }, 
            {
                field: 'Mergecheck',
                title: 'Mergecheck',
            }],
            data:response.data,
            paginationParts: ["pageSize", "pageList"],
            stickyHeader: true,
        })
        $('#statistics .fixed-table-toolbar').attr('id', 'table_3word');
        $('#table_3word').append(`<select class="form-select form-select-sm" aria-label=".form-select-sm example" id="tableSelect1">
            <option selected value="1">Search First</option>
            <option value="2">Search Second</option>
            <option value="4">Search Third</option>
            <option value="3">Search Times</option>
          </select>`);
        //$('#table_3word').append(`<button onclick="resetSearch()" class="btn btn-secondary bg-secondary" id="resetSearch">reset</button>`);
    }

    //顯示P資料
    function printAllPData(searchWord){
        response = getVocabularyData();
        var tokenP = response.data;
        ////console.log("response.data : ", response.data);
        $('#view').empty();
        $('#view').append(`<table id='sortTableP' class="table table-striped" data-toggle="table"  data-search="true"
        data-pagination="true"
        data-pagination-h-align="left"
        data-pagination-detail-h-align="right"
        data-page-size="300"
        data-height="700"        
        </table>`);
        $('#sortTableP').bootstrapTable({
            columns: [{
                field: 'No',
                title: 'No',
                align: 'center',
                valign: 'middle',
                sortable:true,
            },
            {
                field: 'ProperNoun',
                title: 'ProperNoun',
                sortable:true,

            }, 
            {
                field: 'tokenType',
                title: 'tokenType',
                sortable:true,
            }, 
            {
                field: 'NewRE',
                title: 'NewRE',
            }, 
            {
                field: 'UnMerge',
                title: 'UnMerge',
            }, 
            ],
            data:response.data,
            paginationParts: ["pageSize", "pageList"],
            stickyHeader: true,
        })
        $('#view .fixed-table-toolbar').attr('id', 'table_p;');
        if (searchWord){                        
            var resultDataP = document.querySelector('#view.table.table-bordered');
            var searchInput = resultDataP.querySelector('input.search-input');            
            var searchbutton = resultDataP.querySelector('button');
            searchInput.value = Token;
            searchbutton.id = "inputPbutton";
            document.getElementById('inputPbutton').click(); 
        }
    }

    //取得所有資料
    function getTextTokenData(){
        $.ajax({
            async: false,
            type: 'GET',
            url: '{% url 'mark:chineseTwoWord' %}',
            data:{
                "filter_times" : 1,
            },
            success:function (response){
                res = response;
                //////console.log("res : ", res);
            },
        });
        return res;
    }

    //取得所有資料
    function getTextTokenData_3(){
        $.ajax({
            async: false,
            type: 'GET',
            url: '{% url 'mark:chineseThreeWord' %}',
            data:{
                "English" : "Chinese",
                "filter_times" : 1,
            },
            success:function (response){
                res = response;
                //////console.log("res : ", res);
            },
        });
        return res;
    }

    //取得P資料
    function getVocabularyData(){
        var res;
        $.ajax({
            async: false,
            type: 'GET',
            url: '{% url 'mark:getVocabularyByType_Ptable' %}',
            data:{
                "tokenType" : "P",
            },
            success:function (response){
                res = response;
                //////console.log("res : ", res);
            },
        });
        return res;
    }

    function customSearch(data, text) {
        var search = document.getElementsByClassName("form-control search-input");
        //console.log("search : ", search[0]);
        var selectValue = document.getElementById("tableSelect1").value;
        //console.log("selectValue : ", selectValue);
        //console.log("data : ", data);
        //console.log("text : ", text);
        if (text != ""){
            switch (selectValue) {
                case '1':
                    //console.log('select 1');
                    return data.filter(function (row) {
                      return row.First == text;
                    })
                    break;
                case '2':
                    //console.log('select 2');
                    return data.filter(function (row) {
                      return row.Second == text;
                    })
                    break;
                case '3':
                    //console.log('select 3');
                    return data.filter(function (row) {
                      return row.Times >= text;
                    })
                    break;
                case '4':
                    //console.log('select 4');
                    return data.filter(function (row) {
                      return row.Third == text;
                    })
                    break;
                case '0':
                    //console.log('select 0');
                    return data;
                    break;
            }
        }
    
        return data.filter(function (row) {
          return row.Times >= text
        })
      }
    
    //建立挑選器
    function newDualListBox(){
        let dlb2 = new DualListbox('.selectVocabulary', {
            availableTitle:'Available vocabularies',
            selectedTitle: 'Selected vocabularies',
            addButtonText: '>',
            removeButtonText: '<',
            addAllButtonText: '>>',
            removeAllButtonText: '<<',
            searchPlaceholder: 'search vocabulary',
            draggable: true,

        });
        dlb2.addEventListener('added', function(event){
            console.log(event);
        });
        dlb2.addEventListener('removed', function(event){
            console.log(event);
        });
    }
</script> 