function test(){$("#CT-PET").css("margin-top","50px"),$("#CT-PET").css("width",.6*$(window).width()),$("#CT-PET").css("height",$(window).height()-150),$("#frame1").children("label").children("div").children("div").children("img").css("display","none"),$("#frame2").children("label").children("div").children("div").children("img").css("display","none"),$("#frame3").children("label").children("div").children("div").children("img").css("display","none"),$("#frame4").children("label").children("div").children("div").children("img").css("display","none"),$(".slider").css("display","none"),$(".loader").css("display","inline"),$(".loader").css("top",$("#frame1").height()/2),$("#Topcheckbox").prop("chencked",!1),$("#Topcheckbox").prop("disabled",!0)}function ajax1(e){if(1==scrolling1){height=$("#frame1").children("label").children(".slider").height(),b=$("#frame1").children("label").children(".slider").scrollTop(),count1=Math.floor(b/height),plane=$("#frame1").children("label").children("div").children("div").children(".plane").text(),$("#frame1").children("input").is(":checked")&&("Axial"==plane?$("[name='group1']:checked").next("label").children("div").children("div").children(".z").val(count1):"Coronal"==plane?$("[name='group1']:checked").next("label").children("div").children("div").children(".y").val(count1):"Sagittal"==plane&&$("[name='group1']:checked").next("label").children("div").children("div").children(".x").val(count1)),x=$("#frame1").children("label").children("div").children("div").children(".x").val(),y=$("#frame1").children("label").children("div").children("div").children(".y").val(),z=$("#frame1").children("label").children("div").children("div").children(".z").val(),frameXYZ=checkPlaneXYZ(plane,x,y,count1),win_num=$("#select").val();for(var l=[],i=0;i<4;i++)l.push($(".StudyID").eq(i).text());for(var n,i=0;i<4;i++)l[i]==l[0]&&(n=i+1,"Axial"==plane?$("#frame"+n).children("label").children("div").children("div").children(".z").val(count1):"Coronal"==plane?$("#frame"+n).children("label").children("div").children("div").children(".y").val(count1):"Sagittal"==plane&&$("#frame"+n).children("label").children("div").children("div").children(".x").val(count1),ajax_connect_view(n))}}function ajax2(e){if(1==scrolling2){height=$("#frame2").children("label").children(".slider").height(),b=$("#frame2").children("label").children(".slider").scrollTop(),count1=Math.floor(b/height),plane=$("#frame2").children("label").children("div").children("div").children(".plane").text(),$("#frame2").children("input").is(":checked")&&("Axial"==plane?$("[name='group1']:checked").next("label").children("div").children("div").children(".z").val(count1):"Coronal"==plane?$("[name='group1']:checked").next("label").children("div").children("div").children(".y").val(count1):"Sagittal"==plane&&$("[name='group1']:checked").next("label").children("div").children("div").children(".x").val(count1)),x=$("#frame2").children("label").children("div").children("div").children(".x").val(),y=$("#frame2").children("label").children("div").children("div").children(".y").val(),z=$("#frame2").children("label").children("div").children("div").children(".z").val(),frameXYZ=checkPlaneXYZ(plane,x,y,count1),win_num=$("#select").val();for(var l=[],i=0;i<4;i++)l.push($(".StudyID").eq(i).text());for(var n,i=0;i<4;i++)l[i]==l[1]&&(n=i+1,"Axial"==plane?$("#frame"+n).children("label").children("div").children("div").children(".z").val(count1):"Coronal"==plane?$("#frame"+n).children("label").children("div").children("div").children(".y").val(count1):"Sagittal"==plane&&$("#frame"+n).children("label").children("div").children("div").children(".x").val(count1),ajax_connect_view(n))}}function ajax3(e){if(1==scrolling3){height=$("#frame3").children("label").children(".slider").height(),b=$("#frame3").children("label").children(".slider").scrollTop(),$("#frame3").children("input").is(":checked")&&$("[name='group1']:checked").next("label").children(".slider").scrollTop(b),$("#frame3").children("input").is(":checked")&&("Axial"==plane?$("[name='group1']:checked").next("label").children("div").children("div").children(".z").val(count3):"Coronal"==plane?$("[name='group1']:checked").next("label").children("div").children("div").children(".y").val(count3):"Sagittal"==plane&&$("[name='group1']:checked").next("label").children("div").children("div").children(".x").val(count3)),count3=Math.floor(b/height),x=$("#frame3").next("label").children("div").children("div").children(".x").val(),y=$("#frame3").next("label").children("div").children("div").children(".y").val(),z=$("#frame3").next("label").children("div").children("div").children(".z").val(),plane=$("#frame3").children("label").children("div").children("div").children(".plane").text(),frameXYZ=checkPlaneXYZ(plane,x,y,z);for(var l=[],i=0;i<4;i++)l.push($(".StudyID").eq(i).text());for(var n,i=0;i<4;i++)l[i]==l[2]&&(n=i+1,"Axial"==plane?$("#frame"+n).children("label").children("div").children("div").children(".z").val(count3):"Coronal"==plane?$("#frame"+n).children("label").children("div").children("div").children(".y").val(count3):"Sagittal"==plane&&$("#frame"+n).children("label").children("div").children("div").children(".x").val(count3),ajax_connect_view(n))}}function ajax4(e){if(1==scrolling4){height=$("#frame4").children("label").children(".slider").height(),b=$("#frame4").children("label").children(".slider").scrollTop(),$("#check").is(":checked")&&$("#frame4").children("input").is(":checked")&&$("[name='group1']:checked").next("label").children(".slider").scrollTop(b),$("#frame4").children("input").is(":checked")&&("Axial"==plane?$("[name='group1']:checked").next("label").children("div").children("div").children(".z").val(count4):"Coronal"==plane?$("[name='group1']:checked").next("label").children("div").children("div").children(".y").val(count4):"Sagittal"==plane&&$("[name='group1']:checked").next("label").children("div").children("div").children(".x").val(count4)),count4=Math.floor(b/height),x=$("#frame4").next("label").children("div").children("div").children(".x").val(),y=$("#frame4").next("label").children("div").children("div").children(".y").val(),z=$("#frame4").next("label").children("div").children("div").children(".z").val(),plane=$("#frame4").children("label").children("div").children("div").children(".plane").text(),frameXYZ=checkPlaneXYZ(plane,x,y,z),win_num=$("#select").val();for(var l=[],i=0;i<4;i++)l.push($(".StudyID").eq(i).text());for(var n,i=0;i<4;i++)l[i]==l[3]&&(n=i+1,"Axial"==plane?$("#frame"+n).children("label").children("div").children("div").children(".z").val(count4):"Coronal"==plane?$("#frame"+n).children("label").children("div").children("div").children(".y").val(count4):"Sagittal"==plane&&$("#frame"+n).children("label").children("div").children("div").children(".x").val(count4),ajax_connect_view(n))}}function myFunction(e){document.getElementById("dicom1").onmousewheel=function(e){height=$("#frame1").children("label").children(".slider").height(),b=$("#frame1").children("label").children(".slider").scrollTop(),count=Math.round(b/height),e.wheelDelta<0?count++:count--,z=Math.round($("#frame1").children("label").children(".slider").children("div").height()/height),count<0?count=0:count>=z-1&&(count=z-1),b=count*height,$("#frame1").children("label").children(".slider").scrollTop(b),scrolling1=!0,scrolling2=!1,scrolling3=!1,scrolling4=!1},document.getElementById("dicom2").onmousewheel=function(e){height=$("#frame2").children("label").children(".slider").height(),b=$("#frame2").children("label").children(".slider").scrollTop(),count=Math.round(b/height),e.wheelDelta<0?count++:count--,z=Math.round($("#frame2").children("label").children(".slider").children("div").height()/height),count<0?count=0:count>=z-1&&(count=z-1),b=count*height,$("#frame2").children("label").children(".slider").scrollTop(b),scrolling1=!1,scrolling2=!0,scrolling3=!1,scrolling4=!1},document.getElementById("dicom3").onmousewheel=function(e){height=$("#frame3").children("label").children(".slider").height(),b=$("#frame3").children("label").children(".slider").scrollTop(),count=Math.round(b/height),e.wheelDelta<0?count++:count--,z=Math.round($("#frame3").children("label").children(".slider").children("div").height()/height),count<0?count=0:count>=z-1&&(count=z-1),b=count*height,$("#frame3").children("label").children(".slider").scrollTop(b),scrolling1=!1,scrolling2=!1,scrolling3=!0,scrolling4=!1},document.getElementById("dicom4").onmousewheel=function(e){height=$("#frame4").children("label").children(".slider").height(),b=$("#frame4").children("label").children(".slider").scrollTop(),count=Math.round(b/height),e.wheelDelta<0?count++:count--,z=Math.round($("#frame4").children("label").children(".slider").children("div").height()/height),count<0?count=0:count>=z-1&&(count=z-1),b=count*height,$("#frame4").children("label").children(".slider").scrollTop(b),scrolling1=!1,scrolling2=!1,scrolling3=!1,scrolling4=!0}}function bb(){$(".slider").prev(".main").children("div").children("p").text()}function mouseover(e){$("#CTWC").val($("[name='group1']:checked").next("label").children("div").children("div").children(".CTWC").text()),$("#CTWW").val($("[name='group1']:checked").next("label").children("div").children("div").children(".CTWW").text()),$("#PETWC").val($("[name='group1']:checked").next("label").children("div").children("div").children(".PETWC").text()),$("#PETWW").val($("[name='group1']:checked").next("label").children("div").children("div").children(".PETWW").text());var l=$("[name='group1']:checked").next("label").children("div").children("div").children(".StudyDes").text(),i=(i=$("[name='group1']:checked").next("label").children("div").children("div").children(".mode").text()).replace(/\s+/g,"");$("#Mode").val(i).prop("selected",!0);i=$("[name='group1']:checked").next("label").children("div").children("div").children(".CT_window").text();$("#CTWindow").val(i).prop("selected",!0),"PET"==l?($("#Mode").prop("disabled",!1),$("#PETWC").prop("disabled",!1),$("#PETWW").prop("disabled",!1),$("#UseSUVmax").children("input").prop("checked",!0),$("#UseSUVmax").children("input").prop("disabled",!1)):($("#Mode").prop("disabled",!0),$("#PETWC").prop("disabled",!0),$("#PETWW").prop("disabled",!0),$("#UseSUVmax").children("input").prop("checked",!1),$("#UseSUVmax").children("input").prop("disabled",!0));l=(l=$("[name='group1']:checked").next("label").children("div").children("div").children(".plane").text()).replace(/\s+/g,"");$("#viewPlane").val(l).prop("selected",!0),"RTPLAN"==$("[name='group1']:checked").next("label").children("div").children("div").children(".StudyDes").text()?$.ajax({type:"post",url:"{% url 'DICOM:RT_change' %}",data:{WindowNo:$("[name='group1']:checked").next("label").children("div").children("div").children(".series").text(),csrfmiddlewaretoken:window.CSRF_TOKEN},success:function(e){$(".RT_Setting").empty();for(var l=0;l<e.ROIname.length;l++)-1!=e.index&&-1!=e.index.indexOf(l)?$(".RT_Setting").append('<div class="form-check form-switch"><input checked class="form-check-input" onchange="drawContour()" type="checkbox" name="RT" id="'+e.ROIname[l]+'"><label class="form-check-label" for="'+e.ROIname[l]+'">'+e.ROIname[l]+'</label><div style="display:inline-block;position:absolute;right: 0px ;width:20px;height: 20px;background-color: rgb('+e.color[l]+')"></div></div>'):$(".RT_Setting").append('<div class="form-check form-switch"><input class="form-check-input" onchange="drawContour()" type="checkbox" name="RT" id="'+e.ROIname[l]+'"><label class="form-check-label" for="'+e.ROIname[l]+'">'+e.ROIname[l]+'</label><div style="display:inline-block;position:absolute;right: 0px ;width:20px;height: 20px;background-color: rgb('+e.color[l]+')"></div></div>')}}):$(".RT_Setting").empty(),1==win_num?$("#frame1").css("background-color","#33333a"):($("[name='group1']:checked").parents("div").css("background-image","repeating-linear-gradient(to bottom, #FFFFFF 0,#FFFFFF 1%,transparent 1%, transparent 99%),repeating-linear-gradient(to right, #FFFFFF 0,#FFFFFF 1%,#33333a 1%,#33333a 99%)"),$("[name='group1']:not(':checked')").parents("div").css("background","none"),$("[name='group1']:not(':checked')").parents("div").css("background-color","#33333a"));l=$("[name='group1']:checked").next("label").children("div").children("div").children(".series").text();1==l?(scrolling1=!0,scrolling2=!1,scrolling3=!1,scrolling4=!1):2==l?(scrolling1=!1,scrolling2=!0,scrolling3=!1,scrolling4=!1):3==l?(scrolling1=!1,scrolling2=!1,scrolling3=!0,scrolling4=!1):4==l&&(scrolling1=!1,scrolling2=!1,scrolling3=!1,scrolling4=!0)}function ajax_connect_view(e){var l=$("#frame"+e.toString()).children("label").children(".slider").height(),i=$("#frame"+e.toString()).children("label").children(".slider").scrollTop(),n=(Math.round(i/l),$("#frame"+e.toString()).children("label").children("div").children("#dicom"+e).children(".x").val()),i=$("#frame"+e.toString()).children("label").children("div").children("#dicom"+e).children(".y").val(),l=$("#frame"+e.toString()).children("label").children("div").children("#dicom"+e).children(".z").val(),l=checkPlaneXYZ($("#frame"+e.toString()).children("label").children("div").children("div").children(".plane").text(),n,i,l);ajax(e,l.x,l.y,l.z,!0,!0)}function ajax(l,e,i,n,r,d){1==l?urlname="{% url 'DICOM:DICOM_show1' %}":2==l?urlname="{% url 'DICOM:DICOM_show2' %}":3==l?urlname="{% url 'DICOM:DICOM_show3' %}":4==l&&(urlname="{% url 'DICOM:DICOM_show4' %}"),$.ajax({type:"post",url:urlname,data:{variable:n,CTWC:$("#frame"+l.toString()).children("label").children("div").children("div").children(".CTWC").text(),CTWW:$("#frame"+l.toString()).children("label").children("div").children("div").children(".CTWW").text(),PETWC:$("#frame"+l.toString()).children("label").children("div").children("div").children(".PETWC").text(),PETWW:$("#frame"+l.toString()).children("label").children("div").children("div").children(".PETWW").text(),plane:$("#frame"+l.toString()).children("label").children("div").children("div").children(".plane").text(),mode:$("#frame"+l.toString()).children("label").children("div").children("div").children(".mode").text(),x:e,y:i,height:$("#frame"+l.toString()).children("label").children("div").children("div").children("img").height(),width:$("#frame"+l.toString()).children("label").children("div").children("div").children("img").width(),ActualCoordinates:r,drawActualCoordinates:d,csrfmiddlewaretoken:window.CSRF_TOKEN},async:!1,success:function(e){$("#frame"+l.toString()).children("label").children("div").children("div").children("img").attr("src",e.dicom_url)}})}function locationCompute(l,i,n,r){$.ajax({type:"post",url:'{% url "DICOM:convertLocation" %}',data:{z:r,plane:$("#frame"+l.toString()).children("label").children("div").children("div").children(".plane").text(),x:i,y:n,height:$("#frame"+l.toString()).children("label").children("div").children("div").children("img").height(),width:$("#frame"+l.toString()).children("label").children("div").children("div").children("img").width(),PETWC:$("#frame"+l.toString()).children("label").children("div").children("div").children(".PETWC").text(),WindowNo:$("#frame"+l.toString()).children("label").children("div").children("div").children(".series").text(),csrfmiddlewaretoken:window.CSRF_TOKEN},success:function(e){i=e.x,n=e.y,r=e.z,$("#frame"+l.toString()).children("label").children("div").children("div").children(".x").val(e.x),$("#frame"+l.toString()).children("label").children("div").children("div").children(".y").val(e.y),$("#frame"+l.toString()).children("label").children("div").children("div").children(".z").val(e.z),DrawWithMouse(i,n,r,l)}})}function checkPlaneXYZ(e,l,i,n){return"Axial"==e?(frame1_x=l,frame1_y=i,frame1_z=n):"Coronal"==e?(frame1_x=l,frame1_y=n,frame1_z=i):"Sagittal"==e&&(frame1_x=i,frame1_y=n,frame1_z=l),{x:frame1_x,y:frame1_y,z:frame1_z}}function draw(){$("[name='location']:checked").next("label").css("background-color","#e78632");for(var e=$("[name='location']").not(":checked"),l=0;l<e.length;l++)0==e.eq(l).next("label").children(".indices").text()?e.eq(l).next("label").css("background-color","#BBBBBB"):1==e.eq(l).next("label").children(".indices").text()?e.eq(l).next("label").css("background-color","#A8D8B9"):2==e.eq(l).next("label").children(".indices").text()?e.eq(l).next("label").css("background-color","#81C7D4"):3==e.eq(l).next("label").children(".indices").text()&&e.eq(l).next("label").css("background-color","#808F7C");ActualCoordinates=!0,strAry=$("[name='location']:checked").next("label").children(".info").text(),a=strAry.split(","),x=a[0],y=a[1],z=a[2].split("--")[0];for(var i=$("[name='location']:checked").next("label").children(".LocalStudyID").text(),n=[],l=0;l<4;l++)n.push($(".StudyID").eq(l).text());for(var r,l=0;l<4;l++)n[l]==i&&(r=l+1,frame=$("#frame"+r).children("label").children("div").children("#dicom"+r).children(".plane").text(),frameXYZ=checkPlaneXYZ(frame,x,y,z),ajax(r,frameXYZ.x,frameXYZ.y,frameXYZ.z,!0,!0),$("#frame"+r).children("label").children(".slider").scrollTop(frameXYZ.z*$("#frame"+r).children("label").children(".slider").height()),$("#frame"+r).children("label").children("div").children("div").children(".x").val(x),$("#frame"+r).children("label").children("div").children("div").children(".y").val(y),$("#frame"+r).children("label").children("div").children("div").children(".z").val(z))}function DrawWithMouse(e,l,i,n){ActualCoordinates=!0,scrolling=!1;for(var r=[],d=0;d<4;d++)r.push($(".StudyID").eq(d).text());for(var c,d=0;d<4;d++)r[d]==r[n-1]&&(c=d+1,frame=$("#frame"+c).children("label").children("div").children("#dicom"+c).children(".plane").text(),frameXYZ=checkPlaneXYZ(frame,e,l,i),$("#frame"+c).children("label").children("div").children("#dicom"+c).children(".x").val(e),$("#frame"+c).children("label").children("div").children("#dicom"+c).children(".y").val(l),$("#frame"+c).children("label").children("div").children("#dicom"+c).children(".z").val(i),$("#frame"+c).children("label").children(".slider").scrollTop(b),ajax(c,frameXYZ.x,frameXYZ.y,frameXYZ.z,!0,!0),$("#frame"+c).children("label").children(".slider").scrollTop(frameXYZ.z*$("#frame"+c).children("label").children(".slider").height()))}function showReport(){4<$("[name='Report']:checked").length&&$("#"+event.target.id).prop("checked",!1),$("[name='Report']:checked").parents("td").css("background-color","#e78632"),$("[name='Report']:not(':checked')").parents("td").css("background-color","#eeefef");for(var e=0;e<$("[name='Report']:checked").length;e++){var l=$("[name='Report']:checked").eq(e).prev("label").children(".examDate").text()+"\n\n";l+=$("[name='Report']:checked").eq(e).prev("label").children(".examReport").text(),$("#T"+(e+1)).text(l)}1==$("[name='Report']:checked").length&&($("#T1").css("width","100%"),$("#T1").css("height","100%"),$("#T2").css("display","none"),$("#T3").css("display","none"),$("#T4").css("display","none")),2==$("[name='Report']:checked").length&&($("#T1").css("width","100%"),$("#T1").css("height","50%"),$("#T2").css("width","100%"),$("#T2").css("height","50%"),$("#T2").css("display","inline"),$("#T3").css("display","none"),$("#T4").css("display","none")),3==$("[name='Report']:checked").length&&($("#T1").css("width","100%"),$("#T1").css("height","33%"),$("#T2").css("width","100%"),$("#T2").css("height","33%"),$("#T2").css("display","inline"),$("#T3").css("width","100%"),$("#T3").css("height","34%"),$("#T3").css("display","inline"),$("#T4").css("display","none")),4==$("[name='Report']:checked").length&&($("#T1").css("width","100%"),$("#T1").css("height","25%"),$("#T2").css("width","100%"),$("#T2").css("height","25%"),$("#T2").css("display","inline"),$("#T3").css("width","100%"),$("#T3").css("height","25%"),$("#T3").css("display","inline"),$("#T4").css("width","100%"),$("#T4").css("height","25%"),$("#T4").css("display","inline"))}function localmaxclick(e){for(var l=$(event.target).next("label").children(".Localmax_x").text(),i=$(event.target).next("label").children(".Localmax_y").text(),n=$(event.target).next("label").children(".Localmax_z").text(),r=$(event.target).next("label").children(".Localmax_SUV").text(),d=[],c=0;c<4;c++)d.push($(".StudyID").eq(c).text());for(var a,c=0;c<4;c++)d[c]==d[e-1]&&(a=c+1,$("#frame"+a).children("label").children("div").children("div").children(".x").val(l),$("#frame"+a).children("label").children("div").children("div").children(".y").val(i),$("#frame"+a).children("label").children("div").children("div").children(".z").val(n),$("#frame"+a).children("label").children("div").children("div").children(".SUV").val(r));DrawWithMouse(l,i,n,e)}function window_load(){var e=$(event.target).parents(".col").parents(".row").prevAll(".row2").children(".ImageExecDate").html();StudyDes=$(event.target).parents(".col").parents(".row").prevAll(".row2").children(".ImageStudyDes").html().replaceAll(" ","");var l=$(event.target).parents(".col").parents(".row").prevAll(".row2").children(".ImageStudyID").html(),i=$("#PIDText").text(),n=$(event.target).attr("name");$("#frame"+n).children("label").children(".main").children("div").children(".StudyID").text(l),$("#frame"+n).children("label").children(".main").children("div").children(".StudyDes").text(StudyDes),$("#frame"+n).children("label").children(".slider").css("display","none"),$("#frame"+n).children("label").children(".main").children(".loader").css("display","inline"),$("#frame"+n).children("label").children("div").children("div").children("img").css("display","none"),$(".loader").css("top",$("#frame1").height()/2);for(var r=$(".StudyID").eq(0).text(),d=1;d<$(".StudyID").length;d++)r+=","+$(".StudyID").eq(d).text();"PET"==StudyDes?(loadDICOMurlname="{% url 'DICOM:load_DICOM' %}",$("#frame"+n).children("label").children("div").children("div").children(".StudyDes").text("PET"),$("#frame"+n).children("label").children("div").children("div").children(".mode").text("Fusion")):"RTPLAN"==StudyDes?loadDICOMurlname="{% url 'DICOM:load_RT_DICOM' %}":"CT"==StudyDes&&(loadDICOMurlname="{% url 'DICOM:load_CT_DICOM' %}",$("#frame"+n).children("label").children("div").children("div").children(".StudyDes").text("CT"),$("#frame"+n).children("label").children("div").children("div").children(".mode").text("CT")),$.ajax({type:"post",url:loadDICOMurlname,data:{StudyDes:StudyDes,WindowNo:n,root:root,PID:i,MedExecTime:e,StudyIDText:l,csrfmiddlewaretoken:window.CSRF_TOKEN},success:function(e){$(".RT_Setting").empty(),"RTPLAN"==StudyDes&&$.ajax({type:"post",url:'{% url "DICOM:ROIname" %}',data:{WindowNo:n,csrfmiddlewaretoken:window.CSRF_TOKEN},success:function(e){$(".RT_Setting").empty();for(var l=0;l<e.ROIname.length;l++)$(".RT_Setting").append('<div class="form-check form-switch"><input class="form-check-input" onchange="drawContour()" type="checkbox" name="RT" id="'+e.ROIname[l]+'"><label class="form-check-label" for="'+e.ROIname[l]+'">'+e.ROIname[l]+'</label><div style="display:inline-block;position:absolute;right: 0px ;width:20px;height: 20px;background-color: rgb('+e.color[l]+')"></div></div>')}}),$(".loader").css("display","none"),1==n?urlname="{% url 'DICOM:DICOM_show1' %}":2==n?urlname="{% url 'DICOM:DICOM_show2' %}":3==n?urlname="{% url 'DICOM:DICOM_show3' %}":4==n&&(urlname="{% url 'DICOM:DICOM_show4' %}"),name=n,$("#frame"+name.toString()).children("label").children("div").children("div").children("img").css("display","inline-block"),$("#frame"+name.toString()).children("label").children(".slider").css("display","inline-block"),$.ajax({type:"post",url:urlname,data:{variable:0,CTWC:$("#frame"+name.toString()).children("label").children("div").children("div").children(".CTWC").text(),CTWW:$("#frame"+name.toString()).children("label").children("div").children("div").children(".CTWW").text(),PETWC:$("#frame"+name.toString()).children("label").children("div").children("div").children(".PETWC").text(),PETWW:$("#frame"+name.toString()).children("label").children("div").children("div").children(".PETWW").text(),plane:$("#frame"+name.toString()).children("label").children("div").children("div").children(".plane").text(),mode:$("#frame"+name.toString()).children("label").children("div").children("div").children(".mode").text(),x:0,y:0,height:$("#frame"+name.toString()).children("label").children("div").children("div").children("img").height(),width:$("#frame"+name.toString()).children("label").children("div").children("div").children("img").width(),ActualCoordinates:!0,drawActualCoordinates:!0,csrfmiddlewaretoken:window.CSRF_TOKEN},success:function(e){$("#frame"+name.toString()).children("label").children("div").children("div").children("img").attr("src",e.dicom_url),z=e.z,$("#frame"+name.toString()).children("label").children(".slider").children("div").css("height",100*z+"%"),$("#frame"+name.toString()).children("label").children(".slider").scrollTop(0),mouseover()},complete:function(){dicomwindow()}}),$("#frame"+n).children("input").prop("checked",!0),$.ajax({type:"post",url:'{% url "DICOM:selectLocation" %}',data:{PID:$("#PID").val(),Disease:$("#Disease").val(),username:JSON.parse(document.getElementById("user_username").textContent),str:r,csrfmiddlewaretoken:window.CSRF_TOKEN},success:function(e){$("#textarea").children("tr").remove();for(var l=0;l<e.PID.length;l++)$("#textarea").append('<tr><td><input onclick="draw()" type="radio" name="location" id='+l+"><label for="+l+'><p class="deleteInfo">'+e.id[l]+'</p><p class="info">'+e.x[l]+","+e.y[l]+","+e.z[l]+'</p><p class="data">'+e.SUV[l]+'</p><p class="data1">'+e.LabelGroup[l]+'</p><p class="data1">'+e.LabelName[l]+'</p><p class="data1">'+e.LabelRecord[l]+'</p><p class="LocalStudyID">'+e.StudyID[l]+'</p><p class="indices">'+e.indices[l]+"</p></label></td></tr>"),0==e.indices[l]?$("#"+l).next("label").css("background-color","#BBBBBB"):1==e.indices[l]?$("#"+l).next("label").css("background-color","#A8D8B9"):2==e.indices[l]?$("#"+l).next("label").css("background-color","#81C7D4"):3==e.indices[l]&&$("#"+l).next("label").css("background-color","#808F7C");$(".localizationform").scrollTop($("#textarea").height())}})}})}function drawContour(){for(var e=[],l=[],i=0;i<$('input[name="RT"]:checked').length;i++)e.push($('input[name="RT"]:checked').eq(i).next("label").html()),l.push($('input[name="RT"]:checked').eq(i).nextAll("div").css("background-color"));$.ajax({type:"post",url:'{% url "DICOM:DrawContour" %}',data:{WindowNo:$("[name='group1']:checked").next("label").children("div").children("div").children(".series").text(),ROIname:e,Color:l,csrfmiddlewaretoken:window.CSRF_TOKEN},dataType:"json",traditional:!0,success:function(e){}})}function CTWindow_meun(){var e=$("#CTWindow_meun option:selected").val();$("#CTWindow").val(e).prop("selected",!0),dicomwindow()}function right_function(e){var l=e.originalEvent.x||e.originalEvent.layerX||0,e=e.originalEvent.y||e.originalEvent.layerY||0;$("#image_menu").css("display","inline"),$("#image_menu").css("left",l),$("#image_menu").css("top",e)}scrolling1=!1,scrolling2=!1,scrolling3=!1,scrolling4=!1,a=0,jQuery,jQuery,jQuery,jQuery,jQuery;const handleWheel=function(e){(e.ctrlKey||e.metaKey)&&e.preventDefault()};window.addEventListener("wheel",handleWheel,{passive:!1});
$(document).ready(function(i){PID=$("#PIDText").text(),MedExecTime=$("#MedExecTimeText").text(),Item=$("#ItemText").text().replaceAll(" ",""),StudyIDText=$("#StudyIDText").text(),$(document).keydown(function(e){1!=e.ctrlKey||"61"!=e.which&&"107"!=e.which&&"173"!=e.which&&"109"!=e.which&&"187"!=e.which&&"189"!=e.which||e.preventDefault()}),$(window).bind("mousewheel DOMMouseScroll",function(e){1==e.ctrlKey&&e.preventDefault()}),$(document).get(0).oncontextmenu=function(){return!1},$.ajax({type:"post",url:'{% url "confirm:Disease" %}',data:{csrfmiddlewaretoken:window.CSRF_TOKEN},success:function(e){for(var l=0;l<e.DiseaseNo.length;l++)$("#Disease").append('<option value="'+e.DiseaseNo[l]+'">'+e.Disease[l]+"</option>")},complete:function(){$("#Disease").val($("#DiseaseText").text()).prop("selected",!0),$.ajax({type:"post",url:'{% url "DICOM:PatientImageInfo" %}',data:{PID:PID,csrfmiddlewaretoken:window.CSRF_TOKEN},success:function(e){for(var l=0;l<e.ExecDate.length;l++)PID+e.ExecDate[l]+e.StudyID[l]==PID+MedExecTime+StudyIDText?(check="checked",$("#frame1").children("label").children("div").children("div").children(".StudyID").text(e.StudyID[l])):check="",$("#ImageReport").append('<tr><td><div class="container"><div class="row row1" style="text-align: center;margin-bottom: -1px;margin-left: -5px;margin-right: -5px;font-weight: bold;color: whitesmoke;background-color: lightslategray"><div class="col-4">檢查日期</div><div class="col">項目</div><div class="col">StudyID</div><div class="col">張數</div></div><div class="row row2" style="margin-left: -5px;margin-right: -5px;font-weight: bold;color: whitesmoke;background-color: lightslategray"><div class="col-md-auto ImageExecDate">'+e.ExecDate[l]+'</div><div class="col ImageStudyDes">'+e.StudyDes[l]+'</div><div class="col ImageStudyID">'+e.StudyID[l]+'</div><div class="col ImageSliceNo">'+e.SliceNo[l]+'</div></div><div class="row row3" ><div class="col">Win1</div><div class="col">Win2</div><div class="col">Win3</div><div class="col">Win4</div></div><div class="row row4" ><div class="col"><input  onchange="window_load()" style="display: inline;" type="radio" name="1" '+check+'></div><div class="col"><input  onchange="window_load()" style="display: inline;" type="radio" name="2" ></div><div class="col"><input  onchange="window_load()" style="display: inline;" type="radio" name="3" ></div><div class="col"><input  onchange="window_load()" style="display: inline;" type="radio" name="4" ></div></div></div></td></tr>');1==$("#select").val()?($('input[name="2"]').prop("disabled",!0),$('input[name="3"]').prop("disabled",!0),$('input[name="4"]').prop("disabled",!0)):2==$("#select").val()?($('input[name="2"]').prop("disabled",!1),$('input[name="3"]').prop("disabled",!0),$('input[name="4"]').prop("disabled",!0)):4==$("#select").val()&&($('input[name="2"]').prop("disabled",!1),$('input[name="3"]').prop("disabled",!1),$('input[name="4"]').prop("disabled",!1))}}),"PET"==Item?(loadDICOMurlname="{% url 'DICOM:load_DICOM' %}",$("#Mode").val("Fusion"),$("#frame1").children("label").children("div").children("div").children(".StudyDes").text(Item),$("#frame1").children("label").children("div").children("div").children(".mode").text("Fusion")):"CT"==Item?(loadDICOMurlname="{% url 'DICOM:load_CT_DICOM' %}",$("#Mode").val("CT"),$("#frame1").children("label").children("div").children("div").children(".StudyDes").text(Item),$("#frame1").children("label").children("div").children("div").children(".mode").text("CT")):"RTPLAN"==Item?(loadDICOMurlname="{% url 'DICOM:load_RT_DICOM' %}",$("#Mode").val("CT"),$("#frame1").children("label").children("div").children("div").children(".StudyDes").text(Item),$("#frame1").children("label").children("div").children("div").children(".mode").text("CT")):"LDCT"==Item&&(loadDICOMurlname="{% url 'DICOM:load_CT_DICOM' %}",$("#Mode").val("CT"),$("#frame1").children("label").children("div").children("div").children(".StudyDes").text(Item),$("#frame1").children("label").children("div").children("div").children(".mode").text("CT")),root="D:\\image\\",$.ajax({type:"post",url:'{% url "DICOM:TextReport" %}',data:{PID:PID},success:function(e){$("#textReport").children("tr").remove();for(var l=0;l<e.examItem.length;l++)l==e.idx?($("#T1").text(e.examDate[l]+"\n\n"+e.examReport[l]),$("#textReport").append("<tr><td><label for=r"+l+'><p class="examItem">'+e.examItem[l]+'</p><p class="examDate">'+e.examDate[l]+'</p><p class="examReport">'+e.examReport[l]+'</p></label><input checked type="checkbox" onclick="showReport()" name="Report" id=r'+l+"></td></tr>")):$("#textReport").append("<tr><td><label for=r"+l+'><p class="examItem">'+e.examItem[l]+'</p><p class="examDate">'+e.examDate[l]+'</p><p class="examReport">'+e.examReport[l]+'</p></label><input  type="checkbox" onclick="showReport()" name="Report" id=r'+l+"></td></tr>")},complete:function(){$.ajax({type:"post",url:loadDICOMurlname,data:{StudyDes:Item,WindowNo:1,root:root,PID:PID,MedExecTime:MedExecTime,StudyIDText:StudyIDText,csrfmiddlewaretoken:window.CSRF_TOKEN},success:function(e){$.ajax({type:"post",url:'{% url "DICOM:DICOM_show1" %}',data:{variable:0,CTWC:$("#frame1").children("label").children("div").children("div").children(".CTWC").text(),CTWW:$("#frame1").children("label").children("div").children("div").children(".CTWW").text(),PETWC:$("#frame1").children("label").children("div").children("div").children(".PETWC").text(),PETWW:$("#frame1").children("label").children("div").children("div").children(".PETWW").text(),plane:$("#frame1").children("label").children("div").children("div").children(".plane").text(),mode:$("#frame1").children("label").children("div").children("div").children(".mode").text(),x:0,y:0,height:$("#frame1").children("label").children("div").children("div").children("img").height(),width:$("#frame1").children("label").children("div").children("div").children("img").width(),ActualCoordinates:!0,drawActualCoordinates:!0,csrfmiddlewaretoken:window.CSRF_TOKEN},success:function(e){$(".loader").css("display","none"),$("#Topcheckbox").prop("disabled",!1),$("#frame1").children("label").children("div").children("div").children("img").attr("src",e.dicom_url),$("#frame2").children("label").children("div").children("div").children("img").attr("src",e.dicom_url),$("#frame3").children("label").children("div").children("div").children("img").attr("src",e.dicom_url),$("#frame4").children("label").children("div").children("div").children("img").attr("src",e.dicom_url),$("#frame1").children("label").children("div").children("div").children("img").css("display","inline-block"),$("#frame1").children("label").children("div").children("div").children("img").css("display","inline-block"),$("#frame1").children("label").children(".slider").css("display","inline-block"),z=e.z,$(".slider div").css("height",100*z+"%"),$("#CT-PET").css("margin-top","60px"),ActualCoordinates=!1,scrolling1=!0,$("#CT-PET").css("height",$(window).height()-60),$(".slider").css("height",$("#frame1").height()),$("#frame1").children("label").children("div").children("div").children(".StudyID").text($('input[name="1"]:checked').parents(".col").parents(".row4").prevAll(".row2").children(".ImageStudyID").html());for(var l=$(".StudyID").eq(0).text(),i=1;i<$(".StudyID").length;i++)l+=","+$(".StudyID").eq(i).text();$.ajax({type:"post",url:'{% url "DICOM:selectLocation" %}',data:{PID:PID,Disease:$("#Disease").val(),username:JSON.parse(document.getElementById("user_username").textContent),str:l,csrfmiddlewaretoken:window.CSRF_TOKEN},success:function(e){$("#textarea").children("tr").remove();for(var l=0;l<e.PID.length;l++)$("#textarea").append('<tr><td><input onclick="draw()" type="radio" name="location" id='+l+"><label  for="+l+'><p class="deleteInfo">'+e.id[l]+'</p><p class="info">'+e.x[l]+","+e.y[l]+","+e.z[l]+'</p><p class="data">'+e.SUV[l]+'</p><p class="data1">'+e.LabelGroup[l]+'</p><p class="data1">'+e.LabelName[l]+'</p><p class="data1">'+e.LabelRecord[l]+'</p><p class="LocalStudyID">'+e.StudyID[l]+'</p><p class="indices">'+e.indices[l]+"</p></label></td></tr>"),0==e.indices[l]?$("#"+l).next("label").css("background-color","#BBBBBB"):1==e.indices[l]?$("#"+l).next("label").css("background-color","#A8D8B9"):2==e.indices[l]?$("#"+l).next("label").css("background-color","#81C7D4"):3==e.indices[l]&&$("#"+l).next("label").css("background-color","#808F7C");$(".localizationform").scrollTop($("#textarea").height())}}),$(".RT_Setting").empty(),"RTPLAN"==Item&&$.ajax({type:"post",url:'{% url "DICOM:ROIname" %}',data:{WindowNo:1,csrfmiddlewaretoken:window.CSRF_TOKEN},success:function(e){$(".RT_Setting").empty();for(var l=0;l<e.ROIname.length;l++)$(".RT_Setting").append('<div class="form-check form-switch"><input class="form-check-input" onchange="drawContour()" type="checkbox" name="RT" id="'+e.ROIname[l]+'"><label class="form-check-label" for="'+e.ROIname[l]+'">'+e.ROIname[l]+'</label><div style="display:inline-block;position:absolute;right: 0px ;width:20px;height: 20px;background-color: rgb('+e.color[l]+')"></div></div>')}})},complete:function(){$.ajax({type:"post",url:'{% url "DICOM:LabelGroup" %}',data:{SubjectID:1,csrfmiddlewaretoken:window.CSRF_TOKEN},success:function(e){for(var l=0;l<e.LabelGroup.length;l++)$("#tumor").children("#LabelGroup").append("<option data-id="+e.GroupID[l]+">"+e.LabelGroup[l]+"</option>>")},complete:function(){dicomwindow(),mouseover()}})}})}})}})}}),$("#LabelGroup").on("change",function(){0!=$(this).find(":selected").attr("data-id")?$.ajax({type:"post",url:'{% url "DICOM:LabelName" %}',data:{SubjectID:1,LabelGroup:$(this).find(":selected").attr("data-id"),csrfmiddlewaretoken:window.CSRF_TOKEN},success:function(e){$("#LabelName").children("option").remove();for(var l=0;l<e.LabelName.length;l++)$("#tumor").children("#LabelName").append("<option>"+e.LabelName[l]+"</option>>")}}):($("#LabelName").children("option").remove(),$("#tumor").children("#LabelName").append("<option>輸入病灶</option>>"))}),$(function(){$("#frame1").children("label").children("div").children("div").children("img").mousedown(function(e){var l,i,a;1==e.which&&($('input[name="location"]:checked').prop("checked",!1),ActualCoordinates=!1,$("#tumor").css("display","none"),$("#image_menu").css("display","none"),i=parseFloat($("#frame1").children("label").children("div").children("div").children(".Scale_rate").text()),l=$(this).position().left,a=0==$(this).css("margin-top").slice(0,-2)?$(this).position().top:parseFloat($(this).css("margin-top").slice(0,-2))+$(this).position().top,x=Math.floor((e.pageX-l-$(this).parents().parents().parents().parents().position().left-$(this).parents().parents().parents().parents().css("border-left").slice(0,1))/i),y=Math.floor((e.pageY-a-$(this).parents().parents().parents().parents().position().top-$(this).parents().parents().parents().parents().css("border-top").slice(0,1))/i),a=$("#frame1").children("label").children(".slider").height(),i=$("#frame1").children("label").children(".slider").scrollTop(),a=Math.floor(i/a),StudyID=$("#frame1").children("label").children("div").children("div").children(".StudyID").text(),WindowNo=$("#frame1").children("label").children("div").children("div").children(".series").text(),locationCompute(1,x,y,a))})}),$(function(){$("#frame2").children("label").children("div").children("div").children("img").mousedown(function(e){var l,i,a;1==e.which&&($('input[name="location"]:checked').prop("checked",!1),ActualCoordinates=!1,$("#tumor").css("display","none"),$("#image_menu").css("display","none"),i=parseFloat($("#frame2").children("label").children("div").children("div").children(".Scale_rate").text()),l=$(this).position().left,a=0==$(this).css("margin-top").slice(0,-2)?$(this).position().top:parseFloat($(this).css("margin-top").slice(0,-2))+$(this).position().top,x=Math.floor((e.pageX-l-$(this).parents().parents().parents().parents().position().left-$(this).parents().parents().parents().parents().css("border-left").slice(0,1))/i),y=Math.floor((e.pageY-a-$(this).parents().parents().parents().parents().position().top-$(this).parents().parents().parents().parents().css("border-top").slice(0,1))/i),a=$("#frame2").children("label").children(".slider").height(),i=$("#frame2").children("label").children(".slider").scrollTop(),a=Math.floor(i/a),StudyID=$("#frame2").children("label").children("div").children("div").children(".StudyID").text(),WindowNo=$("#frame2").children("label").children("div").children("div").children(".series").text(),locationCompute(2,x,y,a))})}),$(function(){$("#frame3").children("label").children("div").children("div").children("img").mousedown(function(e){var l,i,a;1==e.which&&(ActualCoordinates=!1,$('input[name="location"]:checked').prop("checked",!1),$("#image_menu").css("display","none"),$("#tumor").css("display","none"),i=parseFloat($("#frame3").children("label").children("div").children("div").children(".Scale_rate").text()),l=$(this).position().left,a=0==$(this).css("margin-top").slice(0,-2)?$(this).position().top:parseFloat($(this).css("margin-top").slice(0,-2))+$(this).position().top,x=Math.floor((e.pageX-l-$(this).parents().parents().parents().parents().position().left-$(this).parents().parents().parents().parents().css("border-left").slice(0,1))/i),y=Math.floor((e.pageY-a-$(this).parents().parents().parents().parents().position().top-$(this).parents().parents().parents().parents().css("border-top").slice(0,1))/i),$("#frame3").children("label").children("div").children("div").children(".x").val(x),$("#frame3").children("label").children("div").children("div").children(".y").val(y),a=$("#frame3").children("label").children(".slider").height(),i=$("#frame3").children("label").children(".slider").scrollTop(),a=Math.floor(i/a),StudyID=$("#frame3").children("label").children("div").children("div").children(".StudyID").text(),WindowNo=$("#frame3").children("label").children("div").children("div").children(".series").text(),locationCompute(3,x,y,a))})}),$(function(){$("#frame4").children("label").children("div").children("div").children("img").mousedown(function(e){var l,i,a;1==e.which&&(ActualCoordinates=!1,$('input[name="location"]:checked').prop("checked",!1),$("#image_menu").css("display","none"),$("#tumor").css("display","none"),i=parseFloat($("#frame4").children("label").children("div").children("div").children(".Scale_rate").text()),l=$(this).position().left,a=0==$(this).css("margin-top").slice(0,-2)?$(this).position().top:parseFloat($(this).css("margin-top").slice(0,-2))+$(this).position().top,x=Math.floor((e.pageX-l-$(this).parents().parents().parents().parents().position().left-$(this).parents().parents().parents().parents().css("border-left").slice(0,1))/i),y=Math.floor((e.pageY-a-$(this).parents().parents().parents().parents().position().top-$(this).parents().parents().parents().parents().css("border-top").slice(0,1))/i),$("#frame4").children("label").children("div").children("div").children(".x").val(x),$("#frame4").children("label").children("div").children("div").children(".y").val(y),a=$("#frame4").children("label").children(".slider").height(),i=$("#frame4").children("label").children(".slider").scrollTop(),a=Math.floor(i/a),StudyID=$("#frame4").children("label").children("div").children("div").children(".StudyID").text(),WindowNo=$("#frame4").children("label").children("div").children("div").children(".series").text(),locationCompute(4,x,y,a))})}),$("[name='group1']").next("label").children("div").children("div").children("img").dblclick(function(t){window_number=$("[name='group1']:checked").next("label").children("div").children("div").children(".series").text(),1==$("#trigger").is(":checked")?$.ajax({type:"post",url:'{% url "DICOM:findLocalMax" %}',data:{x:$("[name='group1']:checked").next("label").children("div").children("div").children(".x").val(),y:$("[name='group1']:checked").next("label").children("div").children("div").children(".y").val(),z:$("[name='group1']:checked").next("label").children("div").children("div").children(".z").val(),PETWC:$("[name='group1']:checked").next("label").children("div").children("div").children(".PETWC").text(),StudyID:$("[name='group1']:checked").next("label").children("div").children("div").children(".StudyID").text(),csrfmiddlewaretoken:window.CSRF_TOKEN},success:function(e){name=$("[name='group1']:checked").next("label").children("div").children("div").children(".series").text(),$("#SUV_Localmax").children("tr").remove();for(var l=0;l<e.x.length;l++)0==l?e.maxValue[0]>=$("#PETWC").val()?$("#SUV_Localmax").append('<tr><td><input  type="radio" checked onclick="localmaxclick('+name+')" name="localmax" id=S'+l+"><label for=S"+l+'><p class="Localmax_x">'+e.x[l]+'</p><p class="Localmax_y">'+e.y[l]+'</p><p class="Localmax_z">'+e.z[l]+'</p><p style="display: inline;color: #11171a;width: 106px" class="Localmax_SUV_show">'+Math.round(1e3*(e.maxValue[l]+Number.EPSILON))/1e3+'</p><p style="display: none" class="Localmax_SUV">'+e.maxValue[l]+"</p></label></td></tr>"):$("#SUV_Localmax").append('<tr style="display: none"><td><input  type="radio" checked onclick="localmaxclick('+name+')" name="localmax" id=S'+l+"><label for=S"+l+'><p class="Localmax_x">'+e.x[l]+'</p><p class="Localmax_y">'+e.y[l]+'</p><p class="Localmax_z">'+e.z[l]+'</p><p style="display: inline;color: #11171a;width: 106px" class="Localmax_SUV_show">'+Math.round(1e3*(e.maxValue[l]+Number.EPSILON))/1e3+'</p><p style="display: none" class="Localmax_SUV">'+e.maxValue[l]+"</p></label></td></tr>"):$("#SUV_Localmax").append('<tr><td><input  type="radio" onclick="localmaxclick('+name+')" name="localmax" id=S'+l+"><label for=S"+l+'><p class="Localmax_x">'+e.x[l]+'</p><p class="Localmax_y">'+e.y[l]+'</p><p class="Localmax_z">'+e.z[l]+'</p><p style="display: inline;color: #11171a;width: 106px" class="Localmax_SUV_show">'+Math.round(1e3*(e.maxValue[l]+Number.EPSILON))/1e3+'</p><p style="display: none" class="Localmax_SUV">'+e.maxValue[l]+"</p></label></td></tr>");for(var i=$('input[name="localmax"]:checked').next("label").children(".Localmax_x").text(),a=$('input[name="localmax"]:checked').next("label").children(".Localmax_y").text(),n=$('input[name="localmax"]:checked').next("label").children(".Localmax_z").text(),c=$('input[name="localmax"]:checked').next("label").children(".Localmax_SUV").text(),d=[],l=0;l<4;l++)d.push($(".StudyID").eq(l).text());for(var r,l=0;l<4;l++)d[l]==d[name-1]&&(r=l+1,$("#frame"+r).children("label").children("div").children("div").children(".x").val(i),$("#frame"+r).children("label").children("div").children("div").children(".y").val(a),$("#frame"+r).children("label").children("div").children("div").children(".z").val(n),$("#frame"+r).children("label").children("div").children("div").children(".SUV").val(c));DrawWithMouse(i,a,n,name),(elementClicked="False")==elementClicked&&(t.pageY>$("#CT-PET").height()/2?($("#tumor").css("display","inline"),$("#tumor").css("height",145+$("#SUV_Localmax").parents().height()+15),$("#tumor").css("top",t.pageY-$("#tumor").height())):($("#tumor").css("display","inline"),$("#tumor").css("height",145+$("#SUV_Localmax").parents().height()+15),$("#tumor").css("top",t.pageY)),$("#tumor").css("left",t.pageX+50))}}):($("#SUV_Localmax").children("tr").remove(),(elementClicked="False")==elementClicked&&(t.pageY>$("#CT-PET").height()/2?($("#tumor").css("display","inline"),$("#tumor").css("height",145+$("#SUV_Localmax").parents().height()+15),$("#tumor").css("top",t.pageY-$("#tumor").height())):($("#tumor").css("display","inline"),$("#tumor").css("height",145+$("#SUV_Localmax").parents().height()+15),$("#tumor").css("top",t.pageY)),$("#tumor").css("left",t.pageX+50)),$.ajax({type:"post",url:'{% url "DICOM:findSUV" %}',data:{x:$("[name='group1']:checked").next("label").children("div").children("div").children(".x").val(),y:$("[name='group1']:checked").next("label").children("div").children("div").children(".y").val(),z:$("[name='group1']:checked").next("label").children("div").children("div").children(".z").val(),StudyID:$("[name='group1']:checked").next("label").children("div").children("div").children(".StudyID").text(),isNotPET:$("#UseSUVmax").children("input").is(":disabled"),csrfmiddlewaretoken:window.CSRF_TOKEN},success:function(e){$(".SUV").val(e.SUV)}})),$("#tumor").mousedown(function(){elementClicked="True"}),$("[name='group1']").next("label").children("div").children("div").children("img").mousedown(function(){elementClicked="False"})}),$("#tumor").children("a").mousedown(function(){for(var e=$(".StudyID").eq(0).text(),l=1;l<$(".StudyID").length;l++)e+=","+$(".StudyID").eq(l).text();user_username=JSON.parse(document.getElementById("user_username").textContent),height=$("[name='group1']:checked").next("label").children(".slider").height(),b=$("[name='group1']:checked").next("label").children(".slider").scrollTop(),count=Math.round(b/height),LabelGroup=$("#LabelGroup").val(),LabelName=$("#LabelName").val(),LabelRecord=$("#LabelRecord").val(),$("#tumor").children("select").css("border-color","black"),"輸入病灶"!=LabelGroup?($("#tumor").css("display","none"),elementClicked="False",$.ajax({type:"post",url:'{% url "DICOM:insertLocation" %}',data:{PID:PID,SD:MedExecTime,Item:Item,username:user_username,x:$("[name='group1']:checked").next("label").children("div").children("div").children(".x").val(),y:$("[name='group1']:checked").next("label").children("div").children("div").children(".y").val(),z:$("[name='group1']:checked").next("label").children("div").children("div").children(".z").val(),LabelGroup:LabelGroup,LabelName:LabelName,LabelRecord:LabelRecord,SUV:$("[name='group1']:checked").next("label").children("div").children("div").children(".SUV").val(),plane:$("[name='group1']:checked").next("label").children("div").children("div").children(".plane").text(),height:$("[name='group1']:checked").next("label").children("div").children("div").children("img").height(),width:$("[name='group1']:checked").next("label").children("div").children("div").children("img").width(),ActualCoordinates:!1,Disease:$("#Disease").val(),StudyID:StudyID,WindowNo:WindowNo,str:e,csrfmiddlewaretoken:window.CSRF_TOKEN},success:function(e){$("#textarea").children("tr").remove();for(var l=0;l<e.PID.length;l++)$("#textarea").append('<tr><td ><input onclick="draw()" type="radio" name="location" id='+l+"><label  for="+l+'><p class="deleteInfo">'+e.id[l]+'</p><p class="info">'+e.x[l]+","+e.y[l]+","+e.z[l]+'</p><p class="data">'+e.SUV[l]+'</p><p class="data1">'+e.LabelGroup[l]+'</p><p class="data1">'+e.LabelName[l]+'</p><p class="data1">'+e.LabelRecord[l]+'</p><p class="LocalStudyID">'+e.StudyID[l]+'</p><p class="indices">'+e.indices[l]+"</p></label></td></tr>"),0==e.indices[l]?$("#"+l).next("label").css("background-color","#BBBBBB"):1==e.indices[l]?$("#"+l).next("label").css("background-color","#A8D8B9"):2==e.indices[l]?$("#"+l).next("label").css("background-color","#81C7D4"):3==e.indices[l]&&$("#"+l).next("label").css("background-color","#808F7C");$(".localizationform").scrollTop($("#textarea").height())}})):$("#tumor").children("select").css("border-color","red")}),$("#delete").on("click",function(){for(var e=$(".StudyID").eq(0).text(),l=1;l<$(".StudyID").length;l++)e+=","+$(".StudyID").eq(l).text();id=$('input[name="location"]:checked').next("label").children(".deleteInfo").text(),$.ajax({type:"post",url:'{% url "DICOM:deleteLocation" %}',data:{id:id,PID:PID,Disease:$("#Disease").val(),username:JSON.parse(document.getElementById("user_username").textContent),str:e,csrfmiddlewaretoken:window.CSRF_TOKEN},success:function(e){$("#textarea").children("tr").remove();for(var l=0;l<e.PID.length;l++)$("#textarea").append('<tr><td><input onclick="draw()" type="radio" name="location" id='+l+"><label for="+l+'><p class="deleteInfo">'+e.id[l]+'</p><p class="info">'+e.x[l]+","+e.y[l]+","+e.z[l]+'</p><p class="data">'+e.SUV[l]+'</p><p class="data1">'+e.LabelGroup[l]+'</p><p class="data1">'+e.LabelName[l]+'</p><p class="data1">'+e.LabelRecord[l]+'</p><p class="LocalStudyID">'+e.StudyID[l]+'</p><p class="indices">'+e.indices[l]+"</p></label></td></tr>"),0==e.indices[l]?$("#"+l).next("label").css("background-color","#BBBBBB"):1==e.indices[l]?$("#"+l).next("label").css("background-color","#A8D8B9"):2==e.indices[l]?$("#"+l).next("label").css("background-color","#81C7D4"):3==e.indices[l]&&$("#"+l).next("label").css("background-color","#808F7C");$("#location_menu").css("display","none")}})}),$("#frame1").on("mousedown",function(e){$(this).children("input").prop("checked",!0),mouseover(),$("#tumor").css("display","none"),3==e.which?right_function(e):1==e.which&&$("#image_menu").css("display","none")}),$("#frame2").on("mousedown",function(e){$(this).children("input").prop("checked",!0),mouseover(),$("#tumor").css("display","none"),3==e.which?right_function(e):1==e.which&&$("#image_menu").css("display","none")}),$("#frame3").on("mousedown",function(e){$(this).children("input").prop("checked",!0),mouseover(),$("#tumor").css("display","none"),3==e.which?right_function(e):1==e.which&&$("#image_menu").css("display","none")}),$("#frame4").on("mousedown",function(e){$(this).children("input").prop("checked",!0),mouseover(),$("#tumor").css("display","none"),3==e.which?right_function(e):1==e.which&&$("#image_menu").css("display","none")}),$("#Disease").on("change",function(){for(var e=$(".StudyID").eq(0).text(),l=1;l<$(".StudyID").length;l++)e+=","+$(".StudyID").eq(l).text();$.ajax({type:"post",url:'{% url "DICOM:selectLocation" %}',data:{PID:PID,Disease:$("#Disease").val(),username:JSON.parse(document.getElementById("user_username").textContent),str:e,csrfmiddlewaretoken:window.CSRF_TOKEN},success:function(e){$("#textarea").children("tr").remove();for(var l=0;l<e.PID.length;l++)$("#textarea").append('<tr><td><input onclick="draw()" type="radio" name="location" id='+l+"><label for="+l+'><p class="deleteInfo">'+e.id[l]+'</p><p class="info">'+e.x[l]+","+e.y[l]+","+e.z[l]+'</p><p class="data">'+e.SUV[l]+'</p><p class="data1">'+e.LabelGroup[l]+'</p><p class="data1">'+e.LabelName[l]+'</p><p class="data1">'+e.LabelRecord[l]+'</p><p class="LocalStudyID">'+e.StudyID[l]+'</p><p class="indices">'+e.indices[l]+"</p></label></td></tr>"),0==e.indices[l]?$("#"+l).next("label").css("background-color","#BBBBBB"):1==e.indices[l]?$("#"+l).next("label").css("background-color","#A8D8B9"):2==e.indices[l]?$("#"+l).next("label").css("background-color","#81C7D4"):3==e.indices[l]&&$("#"+l).next("label").css("background-color","#808F7C");$(".localizationform").scrollTop($("#textarea").height())}})}),$("#textarea").on("mousedown","td",function(e){var l;$(this).children('input[type="radio"]').prop("checked",!0),draw(),3==e.which&&1==$('input[name="location"]').is(":checked")&&(l=e.originalEvent.x||e.originalEvent.layerX||0,e=e.originalEvent.y||e.originalEvent.layerY||0,$("#location_menu").css("display","inline"),$("#location_menu").css("left",l),$("#location_menu").css("top",e)),1==i.which&&$("#location_menu").css("display","none")}),$("#CT-PET").mousedown(function(e){1==e.which&&$("#location_menu").css("display","none")}),$("textarea").mousedown(function(e){1==e.which&&($("#location_menu").css("display","none"),$("#image_menu").css("display","none"))}),$(".localizationform").mousedown(function(e){1==e.which&&($("#location_menu").css("display","none"),$("#image_menu").css("display","none"))}),$("body").keydown(function(e){switch(e.keyCode){case 35:$("[name='group1']:checked").next("label").children(".slider").scrollTop($("[name='group1']:checked").next("label").children(".slider").children().height());break;case 36:$("[name='group1']:checked").next("label").children(".slider").scrollTop(0);break;case 45:$("[name='group1']:checked").next("label").children(".slider").scrollTop($("[name='group1']:checked").next("label").children(".slider").children().height()/2);break;case 33:var l=parseFloat($("[name='group1']:checked").next("label").children("div").children("div").children(".Scale_rate").text())+.1;$("[name='group1']:checked").next("label").children("div").children("div").children(".img").css("transform","scale("+l+")"),$("[name='group1']:checked").next("label").children("div").children("div").children(".Scale_rate").text(l);break;case 34:l=parseFloat($("[name='group1']:checked").next("label").children("div").children("div").children(".Scale_rate").text())-.1;$("[name='group1']:checked").next("label").children("div").children("div").children(".img").css("transform","scale("+l+")"),$("[name='group1']:checked").next("label").children("div").children("div").children(".Scale_rate").text(l);break;case 37:img_x=parseFloat($("[name='group1']:checked").next("label").children("div").children("div").css("margin-left").slice(0,-2)),$("[name='group1']:checked").next("label").children("div").children("div").css("margin-left",img_x-5);break;case 38:img_y=parseFloat($("[name='group1']:checked").next("label").children("div").children("div").children(".img").css("margin-top").slice(0,-2)),$("[name='group1']:checked").next("label").children("div").children("div").children(".img").css("margin-top",img_y-5);break;case 39:img_x=parseFloat($("[name='group1']:checked").next("label").children("div").children("div").css("margin-left").slice(0,-2)),$("[name='group1']:checked").next("label").children("div").children("div").css("margin-left",img_x+5);break;case 40:img_y=parseFloat($("[name='group1']:checked").next("label").children("div").children("div").children(".img").css("margin-top").slice(0,-2)),$("[name='group1']:checked").next("label").children("div").children("div").children(".img").css("margin-top",img_y+5)}}),$(window).on("resize",function(){var e=$(this);$("#CT-PET").css("width",.6*e.width()),dicomwindow()}),$("#reset").on("click",function(){var e=$("[name='group1']:checked").next("label").children("div").children("div").children(".StudyDes").text();"PET"==e?$("#Mode").val("Fusion"):"CT"!=e&&"RT"!=e||$("#Mode").val("CT"),$("#viewPlane").val("Axial"),$("#CTWindow").val("45,250").prop("selected",!0),$("#CTWindow_meun").val("45,250").prop("selected",!0),$("#PETWC").val(2.5),$("#PETWW").val(5),dicomwindow(),$("[name='group1']:checked").next("label").children("div").children("div").children(".Scale_rate").text(1);$("[name='group1']:checked").next("label").children("div").children("div").children(".img").css("transform","scale(1)"),$("[name='group1']:checked").next("label").children("div").children("div").children(".img").css("margin",0),$("[name='group1']:checked").next("label").children("div").children("div").css("margin",0),$("#image_menu").css("display","none")}),$("#enlarge").on("click",function(){var e=parseFloat($("[name='group1']:checked").next("label").children("div").children("div").children(".Scale_rate").text())+.1;$("[name='group1']:checked").next("label").children("div").children("div").children(".img").css("transform","scale("+e+")"),$("[name='group1']:checked").next("label").children("div").children("div").children(".Scale_rate").text(e)}),$("#shrink").on("click",function(){var e=parseFloat($("[name='group1']:checked").next("label").children("div").children("div").children(".Scale_rate").text())-.1;$("[name='group1']:checked").next("label").children("div").children("div").children(".img").css("transform","scale("+e+")"),$("[name='group1']:checked").next("label").children("div").children("div").children(".Scale_rate").text(e)})});
